<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±ÙˆØ¶Ù†Ø§</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Cairo',sans-serif}
body{
  margin:0;
  background:#f2f4f8;
  padding:15px
}
header{
  text-align:center;
  margin-bottom:20px
}
header h1{
  margin:0;
  color:#2a5298
}
header p{
  margin-top:5px;
  color:#666
}
.offer{
  background:#fff;
  border-radius:22px;
  box-shadow:0 15px 40px rgba(0,0,0,.18);
  margin-bottom:22px;
  overflow:hidden;
  animation:fadeUp .6s ease;
  position:relative
}
@keyframes fadeUp{
  from{opacity:0;transform:translateY(30px)}
  to{opacity:1;transform:translateY(0)}
}
.offer img{
  width:100%;
  height:auto;
  display:block
}
.badge{
  position:absolute;
  top:12px;
  right:12px;
  background:#e53935;
  color:#fff;
  padding:6px 12px;
  border-radius:14px;
  font-size:12px;
  font-weight:700
}
.content{
  padding:18px
}
.desc{
  font-size:15px;
  line-height:1.8;
  color:#222
}
.timer{
  margin-top:14px;
  padding:14px;
  background:linear-gradient(135deg,#1e3c72,#2a5298);
  color:#fff;
  text-align:center;
  border-radius:16px;
  font-weight:700;
  font-size:14px;
  animation:pulse 1.6s infinite
}
@keyframes pulse{
  0%{opacity:.85}
  50%{opacity:1}
  100%{opacity:.85}
}
.order-btn{
  margin-top:14px;
  width:100%;
  padding:15px;
  border:none;
  border-radius:16px;
  background:#25D366;
  color:#fff;
  font-size:16px;
  font-weight:700;
  cursor:pointer
}
.offer:active{
  transform:scale(.97)
}
.empty{
  text-align:center;
  margin-top:40px;
  color:#777
}
</style>
</head>

<body>

<header>
  <h1>ğŸ”¥ Ø¹Ø±ÙˆØ¶Ù†Ø§ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h1>
  <p>Ø³Ø§Ø±Ø¹ Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª</p>
</header>

<div id="offers"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase
firebase.initializeApp({
  databaseURL:"https://na3ma-customers-default-rtdb.firebaseio.com/"
});
const db = firebase.database();

let WHATSAPP_NUMBER = "";

// Ø¬Ù„Ø¨ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
db.ref("settings/whatsapp").once("value").then(s=>{
  WHATSAPP_NUMBER = s.val() || "";
});

// Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØªØ±ØªÙŠØ¨Ù‡Ø§ Ø­Ø³Ø¨ Ø£Ù‚Ø±Ø¨ Ø§Ù†ØªÙ‡Ø§Ø¡
db.ref("offers").once("value").then(snap=>{
  const now = new Date();
  const list = [];

  snap.forEach(c=>{
    const o=c.val();
    const start=new Date(o.start);
    const end=new Date(o.end);
    if(now>=start && now<end){
      list.push({...o,end});
    }
  });

  list.sort((a,b)=>a.end-b.end);

  if(list.length===0){
    offers.innerHTML='<div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
    return;
  }

  list.forEach(o=>{
    const diff=o.end-now;
    const soon=diff<1000*60*60*24;

    const card=document.createElement("div");
    card.className="offer";
    card.innerHTML=`
      ${soon?'<div class="badge">â° ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ù‹Ø§</div>':""}
      <img src="${o.image}">
      <div class="content">
        <div class="desc">${o.desc}</div>
        <div class="timer"></div>
        <button class="order-btn">ğŸ›’ Ø·Ù„Ø¨ Ø§Ù„Ø¹Ø±Ø¶</button>
      </div>
    `;

    card.querySelector(".order-btn").onclick=()=>{
      if(!WHATSAPP_NUMBER) return;
      const msg=encodeURIComponent(
        `ğŸ›’ Ø·Ù„Ø¨ Ø¹Ø±Ø¶:\n${o.desc}`
      );
      window.open(
        `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`,
        "_blank"
      );
    };

    offers.appendChild(card);
    startTimer(card.querySelector(".timer"),o.end);
  });
});

function startTimer(el,end){
  setInterval(()=>{
    const diff=end-new Date();
    if(diff<=0){
      el.innerText="â›” Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¹Ø±Ø¶";
      return;
    }
    const d=Math.floor(diff/1000/60/60/24);
    const h=Math.floor(diff/1000/60/60)%24;
    const m=Math.floor(diff/1000/60)%60;
    const s=Math.floor(diff/1000)%60;

    el.innerText=`â³ ${d} ÙŠÙˆÙ… Â· ${h} Ø³Ø§Ø¹Ø© Â· ${m} Ø¯Ù‚ÙŠÙ‚Ø© Â· ${s} Ø«Ø§Ù†ÙŠØ©`;
  },1000);
}

const offers=document.getElementById("offers");
</script>

</body>
</html>

