<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø£Ø­Ø¯Ø« Ø§Ù„Ø¹Ø±ÙˆØ¶</title>

<!-- OneSignal -->
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
window.OneSignalDeferred = window.OneSignalDeferred || [];
OneSignalDeferred.push(async function(OneSignal) {
  await OneSignal.init({
    appId: "9fff8ba1-a3f9-45b6-b38c-d141ab4617eb"
  });
});
</script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f6f9}
header{background:#0d47a1;color:#fff;padding:15px;text-align:center;font-size:20px}
.container{padding:15px}
.offer{
 background:#fff;
 border-radius:18px;
 box-shadow:0 5px 15px rgba(0,0,0,.15);
 margin-bottom:20px;
 overflow:hidden
}
.offer img{width:100%;display:block}
.box{padding:15px}
.title{font-size:18px;font-weight:bold}
.desc{margin:10px 0;color:#444}
.timer{
 background:#eee;
 padding:10px;
 border-radius:10px;
 text-align:center;
 font-weight:bold;
 margin-bottom:10px
}
.btn{
 width:100%;
 background:#25D366;
 color:#fff;
 border:none;
 padding:14px;
 font-size:16px;
 border-radius:12px
}
.notify{
 background:#ff9800;
 color:#fff;
 border:none;
 padding:15px;
 width:100%;
 border-radius:15px;
 font-size:17px;
 margin-bottom:15px
}
</style>
</head>

<body>

<header>ğŸ”¥ Ø£Ø­Ø¯Ø« Ø§Ù„Ø¹Ø±ÙˆØ¶ ğŸ”¥</header>

<div class="container">
<button class="notify" onclick="enableNotify()">ğŸ”” ØªÙØ¹ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±ÙˆØ¶</button>
<div id="offers"></div>
</div>

<script>
firebase.initializeApp({
 databaseURL:"https://na3ma-customers-default-rtdb.firebaseio.com"
});

const box = document.getElementById("offers");

function enableNotify(){
 OneSignalDeferred.push(async function(OneSignal){
  await OneSignal.Notifications.requestPermission();
  alert("âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª");
 });
}

function whatsapp(num,title){
 if(!num) return alert("Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± Ù…ØªÙˆÙØ±");
 window.open(
  `https://wa.me/${num}?text=${encodeURIComponent("Ø£Ø±ØºØ¨ ÙÙŠ Ø·Ù„Ø¨ Ø¹Ø±Ø¶: "+title)}`
 );
}

firebase.database().ref("offers").on("child_added",snap=>{
 const o = snap.val();

 const title = o.Al || "";
 const desc  = o.desc || "";
 const img   = o.image || "";
 const start = new Date(o.start).getTime();
 const end   = new Date(o.and).getTime();
 const phone = o.settings?.whatsapp || "";
 const id    = "t"+snap.key;

 box.innerHTML += `
 <div class="offer">
  <img src="${img}">
  <div class="box">
   <div class="title">${title}</div>
   <div class="desc">${desc}</div>
   <div class="timer" id="${id}">...</div>
   <button class="btn" onclick="whatsapp('${phone}','${title}')">
    Ø·Ù„Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
   </button>
  </div>
 </div>`;

 setInterval(()=>{
  const now = Date.now();
  if(now < start){
    document.getElementById(id).innerHTML="â³ Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯";
    return;
  }
  const diff = end - now;
  if(diff<=0){
    document.getElementById(id).innerHTML="âŒ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¹Ø±Ø¶";
    return;
  }
  const d=Math.floor(diff/86400000);
  const h=Math.floor(diff%86400000/3600000);
  const m=Math.floor(diff%3600000/60000);
  const s=Math.floor(diff%60000/1000);
  document.getElementById(id).innerHTML=`â³ ${d}ÙŠ ${h}Ø³ ${m}Ø¯ ${s}Ø«`;
 },1000);
});
</script>

</body>
</html>

