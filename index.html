<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±ÙˆØ¶</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f4f6f9;display:flex;align-items:center;justify-content:center;min-height:100vh}
.card{background:#fff;width:100%;max-width:420px;padding:25px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.15)}
h2{text-align:center;margin-bottom:10px}
p{text-align:center;color:#666}
input,button{width:100%;padding:12px;margin-top:10px;font-size:15px}
input{border:1px solid #ccc;border-radius:8px}
button{background:#1976d2;color:#fff;border:none;border-radius:8px;cursor:pointer}
.msg{text-align:center;margin-top:10px}
.ok{color:green}.err{color:red}
</style>
</head>
<body>

<div class="card">
  <h2>ğŸ“¢ Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ø¹Ø±ÙˆØ¶</h2>
  <p>Ø³Ø¬Ù‘Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„ÙŠØµÙ„Ùƒ ÙƒÙ„ Ø¬Ø¯ÙŠØ¯</p>

  <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
  <input id="city" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">

  <button onclick="register()">ØªØ³Ø¬ÙŠÙ„</button>
  <div id="msg" class="msg"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBwMv6b3Pd6Xjn5Nu4Q4RFV_XFR_6BSsoM",
  authDomain: "na3ma-customers.firebaseapp.com",
  databaseURL: "https://na3ma-customers-default-rtdb.firebaseio.com",
  projectId: "na3ma-customers",
  messagingSenderId: "118299493181",
  appId: "1:118299493181:web:ea8a0b2f1bfbc2bf0d7b54"
});

const db = firebase.database();
const messaging = firebase.messaging();
const msg = document.getElementById("msg");

function register(){
  const name  = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const city  = document.getElementById("city").value.trim();

  if(!name || !phone){
    msg.textContent = "Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†";
    msg.className = "msg err";
    return;
  }

  Notification.requestPermission().then(p => {
    if(p !== "granted"){
      msg.textContent = "ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª";
      msg.className = "msg err";
      return;
    }

    messaging.getToken({
      vapidKey: "BH3AKxpwkwgStqZjgxUMtHB65y1a7-FxtfIiyOpvkakwT02Dt4BS_b-CkeFAuXkh2XFXyIba-dcrif1ZUvVZ9jc"
    }).then(token => {
      return db.ref("customers/" + phone).set({
        name, phone, city,
        fcmToken: token,
        createdAt: Date.now()
      });
    }).then(() => {
      msg.textContent = "ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ”";
      msg.className = "msg ok";
    }).catch(e => {
      msg.textContent = e.message;
      msg.className = "msg err";
    });
  });
}
</script>

</body>
</html>
