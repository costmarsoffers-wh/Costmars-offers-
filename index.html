<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±ÙˆØ¶</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{--primary:#1976d2;--bg:#f2f5f9}
body{margin:0;font-family:Arial;background:var(--bg);display:flex;justify-content:center;align-items:center;min-height:100vh}
.card{background:#fff;width:100%;max-width:420px;padding:30px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
.logo{text-align:center;font-size:22px;font-weight:bold;color:var(--primary)}
.sub{text-align:center;color:#666;margin:10px 0 20px}
input,button{width:100%;padding:12px;margin-top:10px;font-size:15px}
input{border:1px solid #ddd;border-radius:8px}
button{border:none;border-radius:8px;background:var(--primary);color:#fff;cursor:pointer}
.msg{text-align:center;margin-top:15px}
.success{color:green}.error{color:red}
</style>
</head>
<body>

<div class="card">
  <div class="logo">ğŸ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ©</div>
  <div class="sub">Ø³Ø¬Ù‘Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„ÙŠØµÙ„Ùƒ Ø£Ø­Ø¯Ø« Ø§Ù„Ø¹Ø±ÙˆØ¶</div>

  <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
  <input id="city" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">

  <button id="btn">ØªØ³Ø¬ÙŠÙ„</button>
  <div id="msg" class="msg"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBwMv6b3Pd6Xjn5Nu4Q4RFV_XFR_6BSsoM",
  authDomain: "na3ma-customers.firebaseapp.com",
  databaseURL: "https://na3ma-customers-default-rtdb.firebaseio.com",
  projectId: "na3ma-customers",
  messagingSenderId: "118299493181",
  appId: "1:118299493181:web:ea8a0b2f1bfbc2bf0d7b54"
});

const db = firebase.database();
const messaging = firebase.messaging();

const nameEl  = document.getElementById("name");
const phoneEl = document.getElementById("phone");
const cityEl  = document.getElementById("city");
const msgEl   = document.getElementById("msg");
const btnEl   = document.getElementById("btn");

btnEl.addEventListener("click", register);

function register(){
  const name  = nameEl.value.trim();
  const phone = phoneEl.value.trim();
  const city  = cityEl.value.trim();

  if(!name || !phone){
    show("Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†","error");
    return;
  }

  btnEl.disabled = true;
  show("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ...","");

  db.ref("customers/"+phone).get().then(snap=>{
    if(snap.exists()){
      show("Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„","error");
      btnEl.disabled = false;
      return;
    }

    Notification.requestPermission().then(permission=>{
      if(permission !== "granted"){
        show("ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª","error");
        btnEl.disabled = false;
        return;
      }

      messaging.getToken({
        vapidKey:"BH3AKxpwkwgStqZjgxUMtHB65y1a7-FxtfIiyOpvkakwT02Dt4BS_b-CkeFAuXkh2XFXyIba-dcrif1ZUvVZ9jc"
      }).then(token=>{
        if(!token){
          show("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆÙƒÙ†","error");
          btnEl.disabled = false;
          return;
        }

        db.ref("customers/"+phone).set({
          name:name,
          phone:phone,
          city:city,
          fcmToken:token,
          createdAt:Date.now()
        }).then(()=>{
          show("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ”","success");
          btnEl.disabled = false;
        });
      }).catch(err=>{
        show("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙˆÙƒÙ†: "+err.message,"error");
        btnEl.disabled = false;
      });
    });
  });
}

function show(text,type){
  msgEl.innerText = text;
  msgEl.className = "msg " + type;
}
</script>

</body>
</html>
